{% extends "layout.html" %}

{% block title  %}
Listado de usuarios
{% endblock %}

{% block table %}
<h2>
	Listado de Usuarios
</h2>

<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" data-whatever="@getbootstrap">crear usuario</button>


<table class="table table-striped table-dark">
	<thead>
	  <tr>
		<th scope="col">id</th>
		<th scope="col">nombre</th>
		<th scope="col">apellido</th>
		<th scope="col">fecha de cumpleaños</th>
		<th scope="col">email</th>
		<th>acciones</th>
	  </tr>
	</thead>
	<tbody>
    {% for d in users %}
      <tr>
        <th scope="row">{{d.id}}</th>
        <td>{{d.name}}</td>
        <td>{{d.apellido}}</td>
        <td>{{d.birthdate}}</td>
        <td>{{d.email}}</td>
        <td>
          <a aria-label="Delete" class="btn btn-danger" onclick='delete_element("{{d.id}}");'>
            <i aria-hidden="true" class="fa fa-trash" title="Delete this item?"></i>
          </a>
          <a aria-label="" class="btn btn-danger" onclick='load_data("{{d.id}}");'>
            <i class="fa fa-edit"></i>
          </a>
        </td>
      </tr>
    {% endfor %}
  </table>
{% endblock %}

{% block modal %}
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="exampleModalLabel">Crear usuario</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="/create" method="POST">
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Nombre:</label>
            <input name="name" type="text" class="form-control" id="nombre">
          </div>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Apellido:</label>
            <input type="text" name="apellido"  class="form-control" id="apellido">
          </div>
          <div class="form-group">
            <label for="recipient-email" class="col-form-label">email:</label>
            <input type="text" name="email" class="form-control" placeholder="Your email ID.." id="email" >
          </div>
          <div class="form-group">
            <label for="password" class="col-form-label">password:</label>
            <input type="password" name="password" class="form-control" placeholder="password" id="password" >
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label"> fecha de cumpleaños</label>
            <div class="md-form md-outline input-with-post-icon datepicker">
              <input name="birthdate" placeholder="Select date" type="date" id="birthdate" class="form-control">
            </div>  
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="remove_hidden()" data-dismiss="modal">Close</button>
            <input type="submit" class="btn btn-primary" value="Guardar" onclick="remove_hidden()" />
          </div>
        </form>
      </div>
      
    </div>
  </div>
</div>
{% endblock %}

{% block modal_js %}
<script>
$('#exampleModal').on('show.bs.modal', function (event) {
  
  console.log(event)
  var button = $(event.relatedTarget) // Button that triggered the modal
  var recipient = button.data('whatever') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  modal.find('.modal-title').text('New message to ' + recipient)
  modal.find('.modal-body input').val(recipient)
});

function load_data(id){
  $.ajax({
        url: "edit/"+id,
        type: 'GET',
        dataType: 'json',
        success: function(res) {
            console.log(res)
            $("#nombre").val(res.name)
            $("#apellido").val(res.apellido)
            $("#password").val(res.password)
            $("#email").val(res.email)
            $("#birthdate").val(res.birthdate)
            $('#exampleModal form').append( "<input name='id'  id='id_hidden'  type='hidden' value='"+id+"' />" )
            $('#exampleModal').modal('show')
        }
    });
}


function remove_hidden(){

  $('#id_hidden').remove()


}


function delete_element(id){
  
  $.ajax({
        url: "delete/"+id,
        type: 'POST',
        //dataType: 'json',
        success: function(res) {
          console.log(res)
          location.reload();
        }
    });
}

</script>
{% endblock %}





